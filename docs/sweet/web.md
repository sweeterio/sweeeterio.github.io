# web 关键字模块

web 模块测试 Web UI，需要安装浏览器及其驱动，如 Chrome 和 Webdriver 驱动。

## 元素列表

module: `web`

setting: `{'browserName': 'Chrome','headless': False}`

- browserName: Chrome/IE/Firefox

- headless: 无头模式
  - False: 有界面模式
  - True: 无界面模式

## 关键字

### 1. 打开 | OPEN

  在浏览器中打开一个链接。

  打开操作，一般要在测试数据中指定标签页名称，如：#tab=百度。

| 操作   | 元素     | 测试数据  |
| ------ | ------- | --------- |
| `打开` | 百度首页 | #tab=百度 |

  如果需要清理缓存再打开，则在测试数据中写上：`#clear=yes`

| 操作 | 元素     | 测试数据              |
| --- | -------- | --------------------- |
| 打开 | 百度首页 | #tab=百度，`#clear=yes` |

支持自定义 cookie，见`自定义 cookie`章节

### 2. 检查 | CHECK

取页面元素的值或属性与预期结果对比。

测试数据中如果没有写 `k=v` 的方式，则默认是取元素的 `text`。

- 检查 text：

| 操作   | 元素     | 测试数据   |
| ------ | ------- | ---------- |
| `检查` | 搜索按钮 | `百度一下` |

等价于

| 操作   | 元素     | 测试数据        |
| ------ | ------- | -------------- |
| `检查` | 搜索按钮 | `text=百度一下` |

- 检查属性：

| 操作 | 元素   | 测试数据  |
| ---- | ----- | --------- |
| 检查 | 搜索框 | `name=wd` |

- 检查 `title`

检查标签页的标题，直接在测试数据中写预期结果即可。

| 操作 | 元素    | 测试数据            |
| ---- | ------- | ------------------ |
| 检查 | `title` | `百度一下，你就知道` |

- 检查 `current_url`

检查标签页的 url，直接在测试数据中写预期结果即可。

| 操作 | 元素           | 测试数据           |
| ---- | ------------- | ------------------ |
| 检查 | `current_url` | `http://baidu.com` |

注意：

  1. 测试数据中，多个 `k=v` 用英文逗号(`,`)或双英文逗号(`,,`)分隔
  2. 在用英文逗号(`,`)分割时，如果 `v` 中有英文逗号(`,`)，要用反斜杠(`\`)转义
  3. 在用双英文逗号(`,,`)分割时，`v` 中的单英文逗号(`,`)的内容无需转义，例如：

| 操作 | 元素    | 测试数据                                                             |
| ---- | ------ | -------------------------------------------------------------------- |
| GET  | get请求 | `params={'foo1': 'bar1', 'foo2': 'bar2'},,cookies={'user': 'test'}` |

  4. 如果只有一个 `k=v`，也可以尾部加双英文逗号(`,,`)分割，如：

| 操作 | 元素   | 测试数据                                     |
| --- | ------- | ------------------------------------------- |
| GET | get请求 | `params={'foo1': 'bar1', 'foo2': 'bar2'},,` |

> 在同一份用例中，英文逗号(`,`) 和双英文逗号(`,,`)可以混用，但一个单元格内只能使用一种格式。

### 3. 输入 | INPUT

1) 在输入框中输入文本

| 操作   | 元素   | 测试数据   |
| ------ | ----- | ---------- |
| `输入` | 搜索框 | text=Sweet |

如果输入是具有联想功能的下拉菜单时，可能需要逐个字符输入功能（模拟真实的键盘输入场景），应写为 `char=xxx`,如：

| 操作    | 元素   | 测试数据          |
| ------- | ----- | ----------------- |
| `输入`  | 搜索框 | `char=自动化测试` |

在输入操作前，框架会先做清空文本操作，以防止输入框中已有文本；
如果不想做清空文本操作，需在测试数据中，加上：`#clear=no`，如下:

| 操作 | 元素   | 测试数据         |
| ---- | ----- | ---------------- |
| 输入 | 搜索框 | 搜狗, `#clear=no` |

2) 输入框中输入按键

`按键操作`，如：回车键

| 操作 | 元素   | 测试数据       |
| ---- | ----- | -------------- |
| 输入 | 搜索框 | `<Keys.ENTER>` |

`组合按键操作`，如：`ctrl+a`，如下：

| 操作  | 元素   | 测试数据               |
| ----- | ----- | ---------------------- |
| 输入  | 搜索框 | `<Keys.CONTROL\, 'a'>` |

这里的逗号前需要加反斜杠(`\`)来转义；但如果是双逗号(,,)分割，则不需要，如：

| 操作 | 元素   | 测试数据                |
| ---- | ----- | ----------------------- |
| 输入 | 搜索框 | `<Keys.CONTROL, 'a'>,,` |

`文本` + `按键操作`，如：`Sweet` + `回车`

| 操作 | 元素   | 测试数据                         |
| ---- | ----- | -------------------------------- |
| 输入 | 搜索框 | `text=Sweet, text1=<Keys.ENTER>` |

### 4. 点击 | CLICK

1) 点击 | CLICK

点击按钮或者链接等(一切可点击操作的)元素。

| 操作   | 元素     | 测试数据 |
| ------ | ------- | -------- |
| `点击` | 搜索按钮 |          |

当无法正常点击到元素时，可以指定用 js 强制点击，只需要在测试数据里写上：`mode=js`

| 操作   | 元素      |  测试数据  |
| ------ | -------- | ---------- |
| `点击` | 搜索按钮  | `mode=js`  |

2) 右击 | CONTEXT_CLICK

同点击

3) 双击 | DOUBLE_CLICK

同点击

### 5. 悬停 | HOVER

有些页面元素，当鼠标移动到上面（悬停）时，会弹出下拉菜单等。此操作同关键字 `点击` 类似。

| 操作   | 元素  | 测试数据 |
| ------ | ---- | -------- |
| `悬停` | 菜单 |          |

### 6. 拖拽 | DRAG_AND_DROP

把一个元素拖拽到另一个元素上。

| 操作   | 元素                  | 测试数据 |
| ------ | -------------------- | -------- |
| `拖拽` | 测试任务 \| 已完成阶段 |          |

### 7. 滑动 | SWIPE

拖动元素在 x，y 方向上移动移动一段距离。

| 操作   | 元素   |  测试数据     |
| ------ | ----- | ------------ |
| `滑动` | 滑动条 |  x=500,y=100 |


### 8. 执行 | RUN

1) 执行：用例片段

即执行测试用例片段，支持在测试数据中给变量赋值，如我们有用例片段 `SNIPPET_001`，则测试用例 `BAIDU_002` 中，步骤1如下：

| 操作   | 元素          | 测试数据 |
| ------ | ------------- | ------- |
| `执行` | `SNIPPET_001` | kw=深圳  |

把变量 `kw` 赋值为 `深圳`，此步骤会执行用例片段 `SNIPPET_001`，其搜索的关键字为 `深圳`。

**执行** 关键字支持循环次数，只需要在元素列中，`SNIPPET_ID*N`，如：

| 操作  | 元素             | 测试数据 |
| ----- | --------------- | ------- |
| 执行  | `SNIPPET_001*6` | kw=<_kw> |

在循环执行过程中，如果用例片段执行失败，则直接退出。如果想某次循环失败后还继续执行，则只需要在N后加上一个 `*`，如：

| 操作  | 元素              | 测试数据 |
| ----- | ---------------- | ------- |
| 执行  | `SNIPPET_001*6*` | kw=<_kw> |

把测试数据文件中的数据全部循环执行，则循环次数写为 `N`,即 `SNIPPET_ID*N`，如：

| 操作  | 元素             | 测试数据 |
| ----- | --------------- | ------- |
| 执行  | `SNIPPET_001*N` | kw=<_kw> |

同时，循环执行还支持循环结束条件(`#break`)，值可取：`success` 或 `failure`，即当用例片段执行 `success`/`failure` 即跳出，达到结束条件跳出时，测试结果为成功。

`#break` 优先级高于循环次数，但是如果已经把循环次数执行完，还未触发 `#break`，循环也会结束，此时测试结果是失败。如下：

| 操作  | 页面 | 元素     | 测试数据  |
| --- | ---- | -------------- | --------- |
| 执行  | 用例片段 | SNIPPET_001*6 | `#break=success` |

2) 执行：变量赋值

给变量赋值，在后续的测试数据中使用

| 操作   | 元素       | 测试数据         |
| ------ | ---------- | --------------- |
| `执行` | `变量赋值`  | `keywords=深圳` |
| 输入   | 搜索框      | `<keywords>`    |

### 9.  脚本 | SCRIPT

执行 `js` 脚本，`js` 脚本写在元素列。

| 操作 | 元素                                   | 测试数据 |
| ---- | -------------------------------------- | ------- |
| 脚本 | `window.alert('这是一个测试Alert弹窗');` |         |

注意：如果需要在 `frame` 中执行脚本，需要在元素定义表中定义元素，并填写 `frame`，如：

- 元素定义表：

| app   | element   | value                  | by  |  frame |
| ----- | --------- | ---------------------- |---- | ------ |
| baidu | js点击链接 | `$("a.xxx")[0].click()` | js  | #1     |

- 用例：

| 操作 | 元素       | 测试数据 |
| ---- | --------- | -------- |
| 脚本 | js点击链接 |          |

### 10.  对话框 | MESSAGE

弹出对话框(Alert, confirm, prompt)操作，支持如下几个操作：

- 确认
- 取消
- 关闭
- 输入

如：

| 操作  | 元素 | 测试数据 |
| ----- | ---- | ------- |
| 对话框 | 确认 |         |

| 操作   | 元素 | 测试数据    |
| ------ | --- | ----------- |
| 对话框 | 输入 | hello world |

> 注：输入操作，默认自动点击确认按钮

### 11.  \#检查

把检查结果反向。

>暂未实现

### 12. 上传文件 | UPLOAD

- 方式一：input 标签

如果`上传文件`是 input 标签，例如：

```html
<input type="file" name="file" />
```

则可以直接通过 `输入` 关键字来实现上传文件

| 操作    | 元素    | 测试数据      |
| ------- | ------- | ------------ |
| `输入`  | 上传头像 | `D:\pig.png` |

非 input 标签的，则需要方式二

- 方式二：非 input 标签

此关键字仅支持 Windows，需要安装 `win32com`

```bash
pip install pypiwin32
```

测试用例写法如下：

| 操作    | 元素  | 测试数据               |
| ------- | ---- | ---------------------- |
| 上传文件 | 文件 | `file=D:\doc\test.txt` |

备注：

- 测试数据中，`file=` 可以省略
- 不支持路径中包含中文
- 输入法默认设置为英文

### 13. 导航 | NAVIGATE

支持的元素包括：前进、后退、刷新

| 操作 | 元素  | 测试数据    |
| ---- |  ---- | --------- |
| 导航 | 后退  |            |
| 导航 | 前进  |            |
| 导航 | 刷新  |            |

### 14. 滚动条 | SCROLL

对于页面已加载的元素，如果该元素不在可视区域，则框架会自动尝试滚动到元素可见；但有以下2种情况不适用

1. 动态加载的元素(即尚未加载的元素)
2. 内嵌滚动条中被遮挡的元素

对应的，滚动条操作的对象可以是整个页面，也可以是有滚动条的内嵌窗口

- 整个页面格式如下表，元素为空，测试数据为滚动位移，默认值为竖轴(y)，也可以设置横轴(x)

| 操作  | 元素  | 测试数据    |
| ----- | ---- | ---------- |
| 滚动条 |      |  10000     |

测试数据也可以写：`y=1000` 或 `x=500` 或 `y=1000,x=500`

- 内嵌滚动条格式，元素为内嵌滚动条，测试数据如页面格式。

| 操作  | 元素      | 测试数据    |
| ----- | -------- | ---------- |
| 滚动条 | timeline |  10000     |

### 15. 选择 | SELECT

下拉框选择，支持按 index，value，visible_text 方式选择，如

| 操作 | 元素   | 测试数据     |
| ---- | ----- | ----------- |
| 选择 | 下拉框 | index=0     |

需要多选时，按如下方式书写：

| 操作 | 元素   | 测试数据                |
| ---- | ----- | ----------------------- |
| 选择 | 下拉框 | value0=广东,value1=江苏 |

支持混合方式多选：

| 操作 | 元素   | 测试数据            |
| ---- | ----- | ------------------- |
| 选择 | 下拉框 | index=0, value=江苏 |

visible_text 可以简写为 text：

| 操作 | 元素   | 测试数据     |
| --- | ------ | ----------- |
| 选择 | 下拉框 | text=江苏    |

### 16. 取消选择 | DESELECT

取消全部选择下拉框选项

| 操作    | 元素   | 测试数据   |
| ------- | ------ | --------- |
| 取消选择 | 下拉框 | `all=yes` |

取消选择同样支持按 index，value，visible_text 等方式，如：

| 操作     | 元素   | 测试数据    |
| -------- | ------ | ---------- |
| 取消选择  | 下拉框 | index=0    |

## frame 切换

如果有元素在 `iframe`/`frame` 中，则在元素定义表中，该元素需要定义 `frame` 的值，此值可以为 `id`/`name`/`index`/`WebElement`

1. `id` 或 `name` 直接写值即可
2. `index` 以 `#` 开头，如：`#1`。
3. `WebElement` 必须以变量定位法来定义，如 `id#su`，`xpath#//\*[@class="tabIframe"]`

> 注意，`index` 是从 `0` 开始，在嵌套的 `frame` 里，也是从 `0` 开始。

示例：

| app   | element | by  | value | frame |
| ----- | ------- | --- | ----- | ------ |
| baidu | 查询    | id  | su    | `#1`   |

如果是多层 frame,则 frame 中要以依次写上以 `|` 分割的值，如：

| app   | element | by  | value | frame       |
| ----- | ------- | --- | ----- | ----------- |
| baidu | 查询    | id  | su    | `#1\|id#su` |

## 自定义 cookie

支持在`打开`操作中添加自定义 cookie

| 操作 | 元素     | 测试数据  |
| ---- | ------- | --------- |
| 打开 | 百度首页 | #tab=百度,,cookie={'domain':'.baidu.com', 'name': 'SWEET', 'value': '888888'}|

cookie 可以是通过自定义函数获取

| 操作 | 元素    | 测试数据                             |
| ---  | ------- | ----------------------------------- |
| 打开 | 百度首页 | #tab=百度,cookie=`<c.get_cookie()>` |
